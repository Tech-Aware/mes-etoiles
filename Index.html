<!DOCTYPE html>
<html lang="fr">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Mes Etoiles</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <?!= include('Styles'); ?>
</head>
<body>

  <!-- ========== ECRAN ACCUEIL ========== -->
  <div id="screen-home" class="screen active">
    <div class="home-container">
      <div class="home-stars">âœ¨ğŸŒŸâœ¨</div>
      <h1 class="home-title">Mes Etoiles</h1>
      <p class="home-subtitle">Qui veut gagner des etoiles ?</p>
      <div id="personnes-list" class="personnes-list">
        <div class="loader"><div class="loader-star">â­</div></div>
      </div>
    </div>
    <div class="home-decoration">
      <span>ğŸŒˆ</span><span>â­</span><span>ğŸˆ</span><span>ğŸŒŸ</span><span>ğŸ€</span>
    </div>
  </div>

  <!-- ========== ECRAN PRINCIPAL ========== -->
  <div id="screen-main" class="screen">

    <header id="main-header">
      <button class="btn-home" onclick="goHome()">ğŸ </button>
      <div class="header-user">
        <span id="header-avatar" class="header-avatar-img"></span>
        <span id="header-name" class="header-name"></span>
      </div>
      <div class="header-stars">
        <span>â­</span>
        <span id="header-points" class="header-points-num">0</span>
      </div>
    </header>

    <main id="main-content">

      <!-- ===== PAGE EVALUATION ===== -->
      <section id="page-eval" class="page active">

        <div id="already-done" class="already-done" style="display:none;">
          <div class="done-illustration">ğŸ‰</div>
          <h2>C'est fait !</h2>
          <p>Tu as deja gagne tes etoiles aujourd'hui</p>
          <div class="done-message">Reviens demain ! ğŸŒ™</div>
          <button class="btn-see-stars" onclick="showPage('stats')">Voir mes etoiles â­</button>
        </div>

        <div id="eval-form">

          <div class="eval-intro">
            <h2>ğŸŒŸ C'est l'heure des etoiles !</h2>
            <p>Comment ca s'est passe aujourd'hui ?</p>
          </div>

          <!-- ===== CORVEES ===== -->
          <div class="category-section">
            <div class="category-header corvees-bg">
              <span class="category-icon">ğŸ§¹</span>
              <span class="category-title">Mes petits travaux</span>
            </div>
            <div class="tasks-list" data-category="corvees"></div>
          </div>

          <!-- ===== COMPORTEMENT ===== -->
          <div class="category-section">
            <div class="category-header comportement-bg">
              <span class="category-icon">ğŸ’›</span>
              <span class="category-title">Mon comportement</span>
            </div>
            <div class="tasks-list" data-category="comportement"></div>
          </div>

          <!-- ===== RITUELS ===== -->
          <div class="category-section">
            <div class="category-header rituels-bg">
              <span class="category-icon">ğŸŒ…</span>
              <span class="category-title">Mes rituels</span>
            </div>
            <div class="tasks-list" data-category="rituels"></div>
          </div>

          <!-- ===== AUTRES ===== -->
          <div class="category-section">
            <div class="category-header autres-bg">
              <span class="category-icon">âœ¨</span>
              <span class="category-title">Autres</span>
            </div>
            <div class="tasks-list" data-category="autres"></div>
          </div>

          <!-- ===== SECTION EMOTIONS ===== -->
          <div class="category-section emotions-section">
            <div class="category-header emotions-bg">
              <span class="category-icon">ğŸ­</span>
              <span class="category-title">Mes emotions</span>
            </div>
            <div class="emotions-content">

              <!-- Question 1: Comment tu te sens ? -->
              <div class="emotion-question">
                <h3>ğŸ˜Š Comment tu t'es senti(e) aujourd'hui ?</h3>
                <p class="emotion-hint">Choisis jusqu'a 3 emotions</p>

                <div class="emotions-grid">
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜Š', 'Joyeux', this)">
                    <span class="emotion-face">ğŸ˜Š</span>
                    <span class="emotion-name">Joyeux</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜¢', 'Triste', this)">
                    <span class="emotion-face">ğŸ˜¢</span>
                    <span class="emotion-name">Triste</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜ ', 'En colere', this)">
                    <span class="emotion-face">ğŸ˜ </span>
                    <span class="emotion-name">En colere</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜°', 'Inquiet', this)">
                    <span class="emotion-face">ğŸ˜°</span>
                    <span class="emotion-name">Inquiet</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜´', 'Fatigue', this)">
                    <span class="emotion-face">ğŸ˜´</span>
                    <span class="emotion-name">Fatigue</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ¤©', 'Excite', this)">
                    <span class="emotion-face">ğŸ¤©</span>
                    <span class="emotion-name">Excite</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜Œ', 'Calme', this)">
                    <span class="emotion-face">ğŸ˜Œ</span>
                    <span class="emotion-name">Calme</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ¥º', 'Frustre', this)">
                    <span class="emotion-face">ğŸ¥º</span>
                    <span class="emotion-name">Frustre</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ’ª', 'Fier', this)">
                    <span class="emotion-face">ğŸ’ª</span>
                    <span class="emotion-name">Fier</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ™ˆ', 'Timide', this)">
                    <span class="emotion-face">ğŸ™ˆ</span>
                    <span class="emotion-name">Timide</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ¥°', 'Aime', this)">
                    <span class="emotion-face">ğŸ¥°</span>
                    <span class="emotion-name">Aime</span>
                  </button>
                  <button class="emotion-btn" onclick="toggleEmotion('ğŸ˜”', 'Seul', this)">
                    <span class="emotion-face">ğŸ˜”</span>
                    <span class="emotion-name">Seul</span>
                  </button>
                </div>

                <div id="selected-emotions" class="selected-emotions"></div>
              </div>

              <!-- Question 2: Pourquoi ? -->
              <div class="emotion-question">
                <h3>ğŸ¤” C'etait a cause de quoi ?</h3>
                <p class="emotion-hint">Choisis une cause pour chaque emotion</p>
                <div id="sources-by-emotion" class="sources-by-emotion"></div>
              </div>

              <!-- Question 3: Gestion des emotions -->
              <div class="emotion-question">
                <h3>ğŸ§˜ As-tu reussi a gerer tes emotions ?</h3>
                <p class="emotion-hint">Respirer, parler, te calmer...</p>

                <div class="gestion-scale">
                  <button class="gestion-btn" data-value="-1" onclick="setGestion(-1, this)">
                    <span class="gestion-emoji">ğŸ™</span>
                    <span class="gestion-label">Pas facile</span>
                  </button>
                  <button class="gestion-btn" data-value="0" onclick="setGestion(0, this)">
                    <span class="gestion-emoji">ğŸ˜</span>
                    <span class="gestion-label">Bof</span>
                  </button>
                  <button class="gestion-btn" data-value="1" onclick="setGestion(1, this)">
                    <span class="gestion-emoji">ğŸ˜Š</span>
                    <span class="gestion-label">Bien</span>
                  </button>
                </div>
              </div>

            </div>
          </div>

          <!-- ===== HUMEUR GENERALE ===== -->
          <div class="humeur-section">
            <div class="humeur-header">
              <span class="humeur-icon">ğŸ’­</span>
              <span class="humeur-title">En resume, ta journee ?</span>
            </div>
            <div class="humeur-options">
              <button class="humeur-btn" onclick="setHumeur('â›ˆï¸', this)">
                <span class="humeur-emoji">â›ˆï¸</span>
                <span class="humeur-label">Orageux</span>
              </button>
              <button class="humeur-btn" onclick="setHumeur('ğŸŒ§ï¸', this)">
                <span class="humeur-emoji">ğŸŒ§ï¸</span>
                <span class="humeur-label">Pluie</span>
              </button>
              <button class="humeur-btn" onclick="setHumeur('â˜ï¸', this)">
                <span class="humeur-emoji">â˜ï¸</span>
                <span class="humeur-label">Nuageux</span>
              </button>
              <button class="humeur-btn" onclick="setHumeur('ğŸŒˆ', this)">
                <span class="humeur-emoji">ğŸŒˆ</span>
                <span class="humeur-label">Arc-en-ciel</span>
              </button>
              <button class="humeur-btn" onclick="setHumeur('â˜€ï¸', this)">
                <span class="humeur-emoji">â˜€ï¸</span>
                <span class="humeur-label">Soleil</span>
              </button>
            </div>
          </div>

          <!-- ===== MOMENT PREFERE ===== -->
          <div class="favorite-section">
            <label class="favorite-label" for="daily-favorite">Qu'est-ce que j'ai prefere aujourd'hui ?</label>
            <textarea id="daily-favorite" class="favorite-textarea" placeholder="Mon moment prefere..." rows="3"></textarea>
          </div>

          <!-- ===== SCORE PREVIEW ===== -->
          <div class="score-preview">
            <div class="preview-title">Mes etoiles du jour</div>
            <div class="preview-stars">
              <span id="preview-score">0</span>
              <span class="preview-max">/ 0</span>
            </div>
            <div class="preview-bar">
              <div id="preview-fill" class="preview-fill"></div>
            </div>
            <div id="preview-message" class="preview-message">Remplis toutes les cases !</div>
          </div>

          <!-- ===== BOUTON VALIDER ===== -->
          <button id="btn-submit" class="btn-submit" onclick="submitEvaluation()" disabled>
            <span class="btn-icon">ğŸŒŸ</span>
            <span class="btn-text">Gagner mes etoiles !</span>
          </button>

        </div>
      </section>

      <!-- ===== PAGE STATS ===== -->
      <section id="page-stats" class="page">
        <div class="stats-header"><h2>â­ Mes Etoiles</h2></div>
        <div class="week-card">
          <div class="week-title">Cette semaine</div>
          <div class="week-score">
            <span id="stats-week-points" class="week-points-num">0</span>
            <span class="week-points-label">etoiles</span>
          </div>
          <div class="week-bar"><div id="stats-week-fill" class="week-fill"></div></div>
        </div>
        <div class="days-section">
          <h3>ğŸ“… Ma semaine</h3>
          <div id="stats-days" class="days-grid"></div>
        </div>
        <div class="streak-section">
          <div class="streak-fire">ğŸ”¥</div>
          <div class="streak-info">
            <span id="stats-streak" class="streak-num">0</span>
            <span class="streak-label">jours de suite !</span>
          </div>
        </div>
        <!-- Historique emotions -->
        <div class="emotions-history">
          <h3>ğŸ­ Mes emotions recentes</h3>
          <div id="emotions-history-list" class="emotions-history-list"></div>
        </div>
      </section>

      <!-- ===== PAGE FAMILLE ===== -->
      <section id="page-family" class="page">
        <div class="family-header"><h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ La Famille</h2></div>
        <div id="family-list" class="family-list"></div>
      </section>

      <!-- ===== PAGE RECOMPENSES ===== -->
      <section id="page-rewards" class="page">
        <div class="rewards-header">
          <h2>ğŸ Mes Cadeaux</h2>
          <div class="rewards-points">Tu as <strong id="rewards-total">0</strong> etoiles !</div>
        </div>
        <div id="rewards-list" class="rewards-grid"></div>
      </section>

      <!-- ===== PAGE BADGES ===== -->
      <section id="page-badges" class="page">
        <div class="badges-header">
          <h2>ğŸ† Mes Trophees</h2>
          <div class="badges-count"><span id="badges-num">0</span> trophees</div>
        </div>
        <div id="badges-list" class="badges-grid"></div>
      </section>

    </main>

    <!-- Navigation -->
    <nav class="bottom-nav">
      <button class="nav-btn active" onclick="showPage('eval')" data-page="eval">
        <span class="nav-icon">âœï¸</span>
        <span class="nav-label">Evaluer</span>
      </button>
      <button class="nav-btn" onclick="showPage('stats')" data-page="stats">
        <span class="nav-icon">â­</span>
        <span class="nav-label">Etoiles</span>
      </button>
      <button class="nav-btn" onclick="showPage('family')" data-page="family">
        <span class="nav-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
        <span class="nav-label">Famille</span>
      </button>
      <button class="nav-btn" onclick="showPage('rewards')" data-page="rewards">
        <span class="nav-icon">ğŸ</span>
        <span class="nav-label">Cadeaux</span>
      </button>
      <button class="nav-btn" onclick="showPage('badges')" data-page="badges">
        <span class="nav-icon">ğŸ†</span>
        <span class="nav-label">Trophees</span>
      </button>
    </nav>

  </div>

  <!-- ========== MODAL SUCCES ========== -->
  <div id="success-modal" class="modal">
    <div class="modal-content">
      <div id="confetti-container" class="confetti-container"></div>
      <div class="success-stars">ğŸŒŸâœ¨â­âœ¨ğŸŒŸ</div>
      <h2 id="success-title">BRAVO !</h2>
      <p id="success-message"></p>
      <div class="success-score">
        <span id="success-points">0</span>
        <span id="success-max">/ 0 etoiles</span>
      </div>
      <div class="success-stars-display" id="success-stars-display"></div>
      <div id="success-badges" class="success-badges"></div>
      <button class="btn-close" onclick="closeModal()">Super !</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <?!= include('Scripts'); ?>

</body>
</html>
